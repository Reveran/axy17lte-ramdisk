# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

# Initialization
on property:sys.boot_completed=1
   # Set default profile on first boot
   exec u:r:init:s0 root root -- /init.spectrum.sh
   exec u:r:su:s0 root root -- /init.spectrum.sh
   # Enable Spectrum support
   setprop spectrum.support 1
   # Add kernel name
   setprop persist.spectrum.kernel hades

# Balance (default profile)
on property:persist.spectrum.profile=0
   # Setting permissions
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   chmod 0644 /dev/cpuset/foreground/cpus
   chmod 0644 /dev/cpuset/top-app/cpus
   chmod 0644 /sys/kernel/gpu/gpu_min_clock
   chmod 0644 /sys/kernel/gpu/gpu_max_clock

   # Set Governor
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "blu_active"
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "blu_active"

   # Set frequencies
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 344500
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1872000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 344500
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1872000

   # GPU
   write /sys/kernel/gpu/gpu_min_clock 343
   write /sys/kernel/gpu/gpu_max_clock 962
   write /sys/devices/11400000.mali/power_policy "coarse_demand"
   write /sys/devices/11400000.mali/highspeed_load 90

   # IO
   write /sys/block/mmcblk0/queue/scheduler "cfq"
   write /sys/block/mmcblk1/queue/scheduler "cfq"
   write /sys/block/mmcblk0/queue/read_ahead_kb 2048
   write /sys/block/mmcblk1/queue/read_ahead_kb 2048

   # Others
   write /proc/sys/vm/laptop_mode 0
   write /sys/module/mmc_core/parameters/crc 1
   write /sys/module/sync/parameters/fsync_enabled "Y"
   write /sys/kernel/sched/arch_power 1
   write /sys/kernel/dyn_fsync/Dyn_fsync_active 1

# Performance
on property:persist.spectrum.profile=1
   # Setting permissions
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   chmod 0644 /dev/cpuset/foreground/cpus
   chmod 0644 /dev/cpuset/top-app/cpus
   chmod 0644 /sys/kernel/gpu/gpu_min_clock
   chmod 0644 /sys/kernel/gpu/gpu_max_clock

   # Set Governor
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "blu_active"
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "blu_active"

   # Set frequencies
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 757000
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 2002000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 757000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 2002000

   # GPU
   write /sys/kernel/gpu/gpu_min_clock 343
   write /sys/kernel/gpu/gpu_max_clock 962
   write /sys/devices/11400000.mali/power_policy "coarse_demand"
   write /sys/devices/11400000.mali/highspeed_load 80

   # IO
   write /sys/block/mmcblk0/queue/scheduler "deadline"
   write /sys/block/mmcblk1/queue/scheduler "deadline"
   write /sys/block/mmcblk0/queue/read_ahead_kb 2048
   write /sys/block/mmcblk1/queue/read_ahead_kb 2048

   # Others
   write /proc/sys/vm/laptop_mode 1
   write /sys/module/mmc_core/parameters/crc 0
   write /sys/module/sync/parameters/fsync_enabled "N"
   write /sys/kernel/sched/arch_power 0
   write /sys/kernel/dyn_fsync/Dyn_fsync_active 1

# Battery
on property:persist.spectrum.profile=2
   # Setting permissions
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   chmod 0644 /dev/cpuset/foreground/cpus
   chmod 0644 /dev/cpuset/top-app/cpus
   chmod 0644 /sys/kernel/gpu/gpu_min_clock
   chmod 0644 /sys/kernel/gpu/gpu_max_clock

   # Set Governor
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "smartmax_eps"
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "smartmax_eps"

   # Set frequencies
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 344500
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1690000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 344500
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1690000

   # GPU
   write /sys/kernel/gpu/gpu_min_clock 343
   write /sys/kernel/gpu/gpu_max_clock 845
   write /sys/devices/11400000.mali/power_policy "coarse_demand"
   write /sys/devices/11400000.mali/highspeed_load 95

   # IO
   write /sys/block/mmcblk0/queue/scheduler "noop"
   write /sys/block/mmcblk1/queue/scheduler "noop"
   write /sys/block/mmcblk0/queue/read_ahead_kb 2048
   write /sys/block/mmcblk1/queue/read_ahead_kb 2048

   # Others
   write /proc/sys/vm/laptop_mode 1
   write /sys/module/mmc_core/parameters/crc 0
   write /sys/module/sync/parameters/fsync_enabled "N"
   write /sys/kernel/sched/arch_power 1
   write /sys/kernel/dyn_fsync/Dyn_fsync_active 1

# Gaming
on property:persist.spectrum.profile=3
   # Setting permissions
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   chmod 0644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   chmod 0644 /dev/cpuset/foreground/cpus
   chmod 0644 /dev/cpuset/top-app/cpus
   chmod 0644 /sys/kernel/gpu/gpu_min_clock
   chmod 0644 /sys/kernel/gpu/gpu_max_clock

   # Set Governor
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "blu_active"
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "blu_active"

   # Set frequencies
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 546000
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 2002000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 546000
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 2002000

   # GPU
   write /sys/kernel/gpu/gpu_min_clock 449
   write /sys/kernel/gpu/gpu_max_clock 1034
   write /sys/devices/11400000.mali/power_policy "coarse_demand"
   write /sys/devices/11400000.mali/highspeed_load 75

   # IO
   write /sys/block/mmcblk0/queue/scheduler "fiops"
   write /sys/block/mmcblk1/queue/scheduler "fiops"
   write /sys/block/mmcblk0/queue/read_ahead_kb 2048
   write /sys/block/mmcblk1/queue/read_ahead_kb 2048

   # Others
   write /proc/sys/vm/laptop_mode 1
   write /sys/module/mmc_core/parameters/crc 0
   write /sys/module/sync/parameters/fsync_enabled "N"
   write /sys/kernel/sched/arch_power 0
   write /sys/kernel/dyn_fsync/Dyn_fsync_active 0

